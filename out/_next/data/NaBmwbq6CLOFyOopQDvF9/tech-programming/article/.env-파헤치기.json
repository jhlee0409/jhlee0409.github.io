{"pageProps":{"categories":[{"title":"blockchain","sub":[{"title":"DApp","count":1},{"title":"solidity","count":4}]},{"title":"platform","sub":[{"title":"AWS","count":2},{"title":"Google Analytics 4","count":1}]},{"title":"tech","sub":[{"title":"CS","count":1},{"title":"CSS","count":2},{"title":"Data_Structure_&_Algorithms","count":11},{"title":"HTML","count":1},{"title":"javascript","count":4},{"title":"markdown","count":1},{"title":"Next.js","count":1},{"title":"programming","count":3},{"title":"react","count":2},{"title":"refactoring","count":3},{"title":"typescript","count":2}]}],"data":{"title":".env 파헤치기","date":"2022-08-26","tags":["TIL","Programming",".env","Environment Variables"],"draft":false,"summary":"React, Next 에서의 .env"},"content":"# 1. CRA에서의 .env\n- CRA(Creat React App)에서는 `.env`를 어떻게 써야할까\n- 기본적으로 환경 변수를 사용할 수 있도록 세팅되어있다.\n- 변수를 선언해서 사용 가능\n- 선언하려는 변수 명에 `prefix`로  `REACT_APP_` 을 붙여줘야하며 그러지 않을 시 `모두 무시`된다.\n- `REACT_APP_` 이외에도 `NODE_ENV`라는 기본적으로 제공되는 환경 변수도 있다.\n- `NODE_ENV`는 현재 서버 환경을 나타낸다.\n- `NODE_ENV`로 서버 환경별 조건부 실행이 가능하다.\n- `.env` 파일을 수정하면 서버를 재실행 시켜야 변경사항이 반영된다.\n- `.env`에서 선언한 변수는 `process.env`에서 불러온다.\n- `.gitignore`에 `.env`파일들을 추가해 외부에 노출시키지 않도록한다.\n\n## 1-1. 사용법\n\n- 기본\n```jsx\n//.env\nREACT_APP_CLIENT_URL='...'\n// file.js\nprocess.env.REACT_APP_CLIENT_URL\n```\n- `NODE_ENV`의 경우\n```jsx\nprocess.env.NODE_ENV // 환경별로 'development', 'production', 'test'\n```\n- `HTML`의 경우\n```html\n// file.html\n<p>%REACT_APP_CLIENT_URL%</p>\n```\n\n## 1-2. 각 .env 파일 로드 시점\n\n```jsx\n.env.env : 기본 파일\n.env.local : 로컬 설정 오버라이딩. test를 제외한 모든 환경에서 불러와짐\n.env.development : 개발 환경에서 불러와짐\n.env.test : test 환경에서 불러와짐\n.env.production : 빌드된 배포 환경에서 불러와짐\n.env.production.local, .env.test.local, .env.production.local : 환경별 로컬 설정 오버라이딩\n```\n\n## 1-3. 환경별 .env 파일 로드 우선순위\n- 왼쪽이 오른쪽보다 우선순위가 높다.\n\n```jsx\nnpm start: .env.development.local > .env.local > .env.development > .env\nnpm run build: .env.production.local > .env.local > .env.production > .env\nnpm test: .env.test.local > .env.test > .en\n```\n\n## 1-4. 환경 변수 확장\n- `dot-env-expand`를 사용하면 확장 가능\n\n```jsx\nDOMAIN=www.example.com\nREACT_APP_FOO=$DOMAIN/foo\nREACT_APP_BAR=$DOMAIN/bar\n```\n\n#\n\n# 2. Next.js에서의 .env\n\n- 환경 변수를 기본적으로 사용할 수 있도록 세팅되어 있다.\n- `.env.local`로 환경 변수 로드\n- 기본적으로 Node.js 환경에서만 사용 가능하며, 브라우저에 노출이 되지 않지만 `GA 추적코드`와 같은 외부에 노출되어야 하는 변수의 경우 `prefix`로 `NEXT_PUBLIC_`을 붙인다.\n\n## 2-1. 사용법\n- 기본\n```jsx\n//.env.local\nDB_HOST='sample-host'\n// file.js\nprocess.env.DB_HOST\n```\n- 외부 노출의 경우\n```jsx\n// 노출하고 싶으면\nNEXT_PUBLIC_GA_ID='gagaga'\n// file.js\nprocess.env.NEXT_PUBLIC_GA_ID\n```\n\n#\n\n- `process.env`는 js 객체가 아니므로 `구조 분해 할당` 사용 불가\n\n```jsx\n// 불가\nconst { DB_HOST } = process.env;\n```\n\n#\n\n- `$SOME_VALUE`를 통해 확장 가능\n```jsx\n// .env\nHOSTNAME=localhost\nPORT=8080\nHOST=http://$HOSTNAME:$PORT\n```\n\n#\n\n- `$`의 실제 값을 사용하고 싶으면 `\\` 이용\n```jsx\nNAME='jack'\n\nA=MY_NAME_IS$NAME // result =  MY_NAME_ISjack\nB=MY_NAME_IS\\$NAME // result = MY_NAME_ISNAME\n```\n\n## 2-2. 환경 변수 로드 순서\n- 맞는 환경 변수를 찾으면 중단\n1. `process.env`\n2. `.env.production.local`, `.env.development.local`, `.env.test.local`\n3. `.env.local` (test 환경에서는 생략)\n4. `.env.production`, `.env.development`, `.env.test`\n5. `.env`\n\n#\n\n#### 참조\n- [Next.js ENV](https://nextjs.org/docs/basic-features/environment-variables#loading-environment-variables)\n- [CRA ENV](https://create-react-app.dev/docs/adding-custom-environment-variables/#what-other-env-files-can-be-used)\n\n#\n\n#### 피드백은 언제나 환영입니다."},"__N_SSG":true}